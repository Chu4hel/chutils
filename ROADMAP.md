# Дорожная карта

Этот документ содержит план действий по улучшению проекта.

## 1. Устранение проблем с `.gitignore`

Приоритет: Высокий

* **Проблема:** Директория `.idea/` (файлы IDE) отслеживается Git.
* **План:**
    * Раскомментировать строку `.idea/` в `.gitignore` (уже сделано).
    * Пользователю необходимо выполнить команду `git rm -r --cached .idea` для удаления папки из индекса Git.

## 2. Оптимизация логирования (f-строки)

* **Проблема:** Использование f-строк в вызовах логгера приводит к немедленному вычислению сообщений, даже если они не
  будут выведены.
* **План:**
    * Найти все вхождения `logger.level(f"...")` в файлах `src/` и `examples/`.
    * Заменить их на `logger.level("...", arg1, arg2)` для "ленивого" форматирования.

## 3. Улучшение именования логгеров

* **Проблема:** Недостаточно ясно, как создавать логгеры с разными именами.
* **План:**
    * Обновить `README.md` и документацию (`docs/api.md`), чтобы явно показать, как использовать параметр `name` в
      `setup_logger()` для создания именованных логгеров.
    * Упомянуть пример `05_different_log_levels.py`

## 4. Улучшение `get_config_int` (и `get_config_float`)

* **Проблема:** Функции молчаливо возвращают `fallback` при ошибке преобразования типа.
* **План:**
    * Модифицировать `get_config_int` и `get_config_float` для вывода `logger.warning` при неудачной попытке
      преобразования типа.

## 5. Консистентность `os.path` и `pathlib`

* **Проблема:** Непоследовательное использование `os.path` и `pathlib.Path`
* **План:**
    * Заменить все вызовы `os.path` на эквивалентные методы `pathlib.Path` для единообразия.

## 6. Проверка расширения файла конфигурации

* **Проблема:** Файл конфигурации открывается до проверки его расширения.
* **План:**
    * Рефакторинг логики загрузки конфигурации в `config.py` для проверки расширения файла (`.ini` или `.yml`) *перед*
      его открытием.

## 7. Стиль `if config is None: ...`

* **Проблема:** Однострочные `if` выражения.
* **План:**
    * Изменить однострочные `if config is None: config = get_config()` на многострочные блоки для лучшей читаемости.

## 8. Рефакторинг больших функций (`get_config`)

* **Проблема:** Функция `get_config` слишком большая и содержит логику для разных форматов.
* **План:**
    * Разделить `get_config` на более мелкие, специализированные функции: `_load_yaml(path)` и `_load_ini(path)`.
    * `get_config` будет выступать в роли оркестратора, вызывая нужную функцию в зависимости от расширения файла.

## 9. Документирование `DEVDEBUG` и `MEDIUMDEBUG`

* **Проблема:** Отсутствие четкого объяснения назначения пользовательских уровней логирования.
* **План:**
    * Добавить в docstring `ChutilsLogger` и в основную документацию (`docs/api.md`) объяснение:
        * `DEBUG`: Обычная отладочная информация.
        * `MEDIUMDEBUG` (уровень 15): Информация, близкая к `INFO`, но более детализированная, чем `DEBUG`.
        * `DEVDEBUG` (уровень 9): Максимально подробный вывод, включая дампы переменных, для глубокой отладки.

## 10. Улучшение `setup_logger` (default `log_level_str` и `Enum`)

* **Проблема:** Неочевидное значение по умолчанию для `log_level_str` (`''`) и отсутствие `Enum` для уровней.
* **План:**
    * Изменить значение по умолчанию `log_level_str` в `setup_logger` на `'INFO'`.
    * Ввести `Enum` для уровней логирования, чтобы обеспечить лучшую валидацию и автодополнение.

## 11. Уточнение `get_config_value` (fallback `""` vs `None`)

* **Проблема:** Неясность в поведении `get_config_value` при пустой строке.
* **План:**
    * Изменить значение `fallback` по умолчанию в `get_config_value` на `None`.
    * Добавить логику, чтобы пустые строки, прочитанные из конфига, трактовались как отсутствующее значение и возвращали
      `fallback`.

## 12. Поддержка `.env` файлов в `secret_manager`

* **Проблема:** `keyring` может быть неудобен в некоторых средах (например, Docker), `.env` — более универсальный
  стандарт.
* **План:**
    * Добавить поддержку `.env` файлов в `secret_manager.py`.
    * Реализовать логику, при которой `secret_manager` сначала пытается получить секрет из `keyring`, а при неудаче (или
      по конфигурации) ищет его в `.env` файле в корне проекта.

## 13. Разделение лог-файлов по именам логгеров

* **Проблема:** Все логгеры по умолчанию пишут в один и тот же файл, указанный в глобальной конфигурации.
* **План:**
    * Добавить опциональный параметр `log_file_name: Optional[str] = None` в функцию `setup_logger`.
    * Если этот параметр указан, логгер будет писать в указанный файл.
    * Если параметр не указан, будет использоваться `log_file_name` из глобальной конфигурации.

## 14. Расширенные опции ротации логов (по размеру и сжатие)

* **Проблема:** Текущая ротация логов осуществляется только по времени. Нет возможности ротировать по размеру файла и
  сжимать старые логи.
* **План:**
    * Добавить в `setup_logger` (или в конфигурацию `Logging`) опции для:
        * Выбора типа ротации: по времени (`TimedRotatingFileHandler`) или по размеру (`RotatingFileHandler`).
        * Указания максимального размера файла для ротации по размеру.
        * Опционального сжатия ротированных лог-файлов (например, с использованием `gzip` из стандартной библиотеки).
          Это не потребует новых внешних зависимомостей, но потребует дополнительной реализации.

## 15. Исключение нерелевантных файлов из дистрибутива пакета

Приоритет: Высокий

* **Проблема:** При сборке и распространении пакета (`pip install chutils`) в него могут попадать файлы, не являющиеся
  частью самой библиотеки (тесты, примеры, документация, файлы IDE).
* **План:**
    * Добавить параметр `exclude` в секцию `[tool.poetry]` файла `pyproject.toml`.
    * В `exclude` будут включены такие директории и файлы, как `tests/`, `examples/`, `docs/`, `.github/`, `.idea/`,
      `__pycache__/`, `*.pyc`, `*.log`, `*.egg-info/`, `.vscode/`, `.ruff_cache/`, `coverage.xml`, `.coverage`.

## 18. Поддержка переопределения конфигурации локальным файлом

* **Проблема:** Отсутствует встроенная поддержка для переопределения параметров основного конфигурационного файла (
  `config.yml`/`config.ini`) локальным файлом (например, `config.local.yml`), который может быть добавлен в
  `.gitignore`.
* **План:**
    * Реализовать механизм, позволяющий `chutils.config` загружать несколько конфигурационных файлов.
    * Параметры из локального файла будут переопределять соответствующие параметры из основного файла.
    * Это позволит удобно управлять чувствительными или специфичными для разработчика настройками, не коммитя их в
      репозиторий.
* **Приоритет:** Низкий

## 19. Предотвращение конфликтов имен в Keyring

* **Проблема:** Существует риск того, что другое приложение может использовать то же `service_name` в `keyring`, что
  приведет к перезаписи или несанкционированному доступу к секретам.
* **Текущее решение:** Добавленная возможность указывать пользовательский `prefix` для `SecretManager` уже позволяет
  пользователям самостоятельно управлять уникальностью `service_name`.
* **План:**
    * Рассмотреть возможность использования более уникального префикса по умолчанию, **включающего путь к проекту или
      его хэш**, чтобы гарантировать уникальность `service_name` для каждого проекта.
    * Улучшить документацию, чтобы подчеркнуть важность выбора уникального `service_name` и использования `prefix`.
* **Приоритет:** Низкий